<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>What is GKS2slurm ? - GalaxyKickStart</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "What is GKS2slurm ?";
    var mkdocs_page_input_path = "GKS2slurm.md";
    var mkdocs_page_url = "/GKS2slurm/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> GalaxyKickStart</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../about/">What is GalaxyKickStart</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../getting_started/">Getting started</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../customizations/">Customising the playbook</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../installing_tools_and_workflows/">Installing tools and workflows</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Examples</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../examples/docker/">Docker</a>
                </li>
                <li class="">
                    
    <a class="" href="../examples/vagrant/">Deploying galaxy-kickstart on local virtual machine (VM) using vagrant.</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../faq/">Frequently asked questions</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../available_roles/">Available roles</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../available_variables/">Available variables</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">GalaxyKickStart Use Cases</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../metavisitor/">Metavisitor</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">What is GKS2slurm ?</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#what-is-gks2slurm">What is GKS2slurm ?</a></li>
    

    <li class="toctree-l3"><a href="#installation-of-a-galaxy-slurm-cluster-with-gks2slurm">Installation of a Galaxy slurm cluster with GKS2slurm</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#step-1-install-a-galaxy-server-with-galaxykickstart">Step 1: Install a Galaxy server with GalaxyKickStart</a></li>
        
            <li><a class="toctree-l4" href="#step-2-check-the-single-node-galaxy-installation">Step 2: Check the single node Galaxy installation</a></li>
        
            <li><a class="toctree-l4" href="#step-3-moving-your-single-node-configuration-to-a-multinode-slurm-configuration">Step 3: Moving your single node configuration to a multinode slurm configuration</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#checking-slurm-installation">Checking slurm installation</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../GKSfromWorflows/">GKSfromWorflows</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">GalaxyKickStart</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>GalaxyKickStart Use Cases &raquo;</li>
        
      
    
    <li>What is GKS2slurm ?</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="what-is-gks2slurm">What is GKS2slurm ?</h1>
<p>GKS2slurm is a playbook that is played to install a multinode slurm cluster over a GalaxyKickStart single-node installation.
The playbook GKS2slurm <code>galaxyToSlurmCluster.yml</code> was tested with multiple virtual machines (VMs) in <code>Stratuslab</code>, <code>Google Cloud Engine (GCE)</code> and <code>Amazon Web Services (AWS)</code> clouds.</p>
<h1 id="installation-of-a-galaxy-slurm-cluster-with-gks2slurm">Installation of a Galaxy slurm cluster with GKS2slurm</h1>
<h2 id="step-1-install-a-galaxy-server-with-galaxykickstart">Step 1: Install a Galaxy server with GalaxyKickStart</h2>
<ul>
<li>
<p>Report to the <a href="../getting_started/">Getting Started</a> section of this manual for the basics of GalaxyKickStart installation</p>
</li>
<li>
<p>install any GalaxyKickStart "flavor" by configuring the inventory file (in inventory_files folder) and the group_vars file (in the group_vars folder) of your choice.
Flavors currently available are <code>kickstart</code>, <code>artimed</code> and <code>metavisitor</code> but other will come soon. Alternatively, you can build you own flavor by customizing a group_vars, extrafiles file and inventory file, which will install your Galaxy tools and workflows.</p>
<p><strong>in Step 1, the most important thing to keep track with is to configure your target machine with an extra volume</strong></p>
<p>Indeed GKS2slurm has be designed so that the Galaxy slurm cluster can accumulate large amount of data in the long term, which can be more easily shared with the cluster nodes and more importantly backed up.</p>
<p>Thus in addition of all the adaptations you will do for your own purpose (tools, workflows, etc), edit the <code>group_vars/all</code> file and adapt the <code>galaxy_persistent_directory</code> variable to your extra volume which should be already formatted and mounted:</p>
<p>Change</p>
</li>
</ul>
<pre><code>#persistent data
galaxy_persistent_directory: /export # for IFB it's /root/mydisk, by default, /export
</code></pre>

<p>To</p>
<pre><code>#persistent data
galaxy_persistent_directory: /pathto/mounted/extravolume
</code></pre>

<ul>
<li>Having configured your GalaxyKickStart installation, import the extra roles (if not already done)</li>
</ul>
<pre><code>ansible-galaxy install -r requirements_roles.yml -p roles
</code></pre>

<p>and run the galaxy.yml playbook:</p>
<pre><code>ansible-playbook --inventory-file inventory_files/&lt;your_inventory_file&gt; galaxy.yml
</code></pre>

<h2 id="step-2-check-the-single-node-galaxy-installation">Step 2: Check the single node Galaxy installation</h2>
<p>If the playbook was run successfully, connect to your Galaxy instance through http and check that you can login (admin@galaxy.org:admin), and that tools and workflows are correctly installed.</p>
<h2 id="step-3-moving-your-single-node-configuration-to-a-multinode-slurm-configuration">Step 3: Moving your single node configuration to a multinode slurm configuration</h2>
<ul>
<li>Start as many compute nodes you want for the slurm cluster and gather information from each node:<ul>
<li>IP address (all slurm nodes should must be accessible in the same network, ie nodes can be ping-ed from any nodes)</li>
<li>hostname</li>
<li>number of CPUs</li>
<li>memory (in MB)</li>
</ul>
</li>
</ul>
<h3 id="step-3-1">Step 3-1</h3>
<p>Adapt the inventory file <code>slurm-kickstart</code> in the inventory_files folder.</p>
<pre><code>[slurm_master]
# adapt the following line to IP address and ssh user of the slurm master node
192.54.201.102 ansible_ssh_user=root ansible_ssh_private_key_file=&quot;~/.ssh/mysshkey&quot;

[slurm_slave]
# adapt the following lnes to IP addresses and ssu users of the slum slave nodes
192.54.201.98 ansible_ssh_user=root ansible_ssh_private_key_file=&quot;~/.ssh/mysshkey&quot;
192.54.201.99 ansible_ssh_user=root ansible_ssh_private_key_file=&quot;~/.ssh/mysshkey&quot;
192.54.201.101 ansible_ssh_user=root ansible_ssh_private_key_file=&quot;~/.ssh/mysshkey&quot;
</code></pre>

<h3 id="step-3-2">Step 3-2</h3>
<p>Adapt the group_vars file <code>slurm_master</code> in the <code>group_vars</code> folder.
This is done using the information gathered in step 3</p>
<pre><code># nfs sharing
cluster_ip_range: &quot;0.0.0.0/24&quot; # replace by your ip network range

# slave node specifications, adapt to your set of slave nodes
slave_node_dict:
  - {hostname: &quot;slave-1&quot;, CPUs: &quot;2&quot;, RealMemory: &quot;7985&quot;}
  - {hostname: &quot;slave-2&quot;, CPUs: &quot;2&quot;, RealMemory: &quot;7985&quot;}
  - {hostname: &quot;slave-3&quot;, CPUs: &quot;2&quot;, RealMemory: &quot;7985&quot;}
</code></pre>

<h3 id="step-3-3">Step 3-3</h3>
<p>Adapt the group_vars file <code>slurm_slave</code> in the <code>group_vars</code> folder</p>
<pre><code># adapt the following variable to the master slurm node IP address
master_slurm_node_ip: &quot;192.54.201.102&quot;
</code></pre>

<h3 id="step-3-4">Step 3-4</h3>
<p>Run the playbook <code>galaxyToSlurmCluster.yml</code> playbook.
from the GalaxyKickStart directory:</p>
<pre><code>ansible-playbook -i inventory_files/slurm-kickstart galaxyToSlurmCluster.yml
</code></pre>

<p>Note that if you configure multiple slave nodes without prior ssh key authentification, you can run the same command with the variable ANSIBLE_HOST_KEY_CHECKING put to False:</p>
<pre><code>ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook -i inventory_files/slurm-kickstart galaxyToSlurmCluster.yml
</code></pre>

<h1 id="checking-slurm-installation">Checking slurm installation</h1>
<p>Connect to your master node as root and type <code>sinfo</code>
Refer to slurm documentation for more investigation/control</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../GKSfromWorflows/" class="btn btn-neutral float-right" title="GKSfromWorflows">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../metavisitor/" class="btn btn-neutral" title="Metavisitor"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../metavisitor/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../GKSfromWorflows/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
